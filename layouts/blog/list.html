{{ define "main" }}

  <div class="blog-page">
    
    <!-- Hero Section -->
    <section class="blog-hero">
      <div class="hero-container">
        <div class="hero-content">
          <h1 class="hero-title">
            <span class="title-icon">üìö</span>
            Blog L·∫≠p Tr√¨nh M·∫°ng
          </h1>
          <p class="hero-description">
            Kh√°m ph√° nh·ªØng ki·∫øn th·ª©c s√¢u v·ªÅ l·∫≠p tr√¨nh m·∫°ng, c√¥ng ngh·ªá backend v√† c√°c xu h∆∞·ªõng ph√°t tri·ªÉn ph·∫ßn m·ªÅm m·ªõi nh·∫•t
          </p>
          
          <!-- Search and Filter -->
          <div class="blog-controls">
            <div class="search-wrapper">
              <input type="text" id="blog-search" placeholder="T√¨m ki·∫øm b√†i vi·∫øt..." class="blog-search-input">
              <button id="search-btn" class="search-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </button>
              
              <!-- Search Suggestions -->
              <div class="search-suggestions" id="search-suggestions">
                <div class="suggestions-header">
                  <span class="suggestions-title">G·ª£i √Ω t√¨m ki·∫øm</span>
                  <button class="suggestions-close" id="suggestions-close">√ó</button>
                </div>
                <div class="suggestions-content">
                  <div class="suggestion-category">
                    <h4 class="category-title">Ch·ªß ƒë·ªÅ ph·ªï bi·∫øn</h4>
                    <div class="suggestion-tags">
                      <button class="suggestion-tag" data-search="java">Java Programming</button>
                      <button class="suggestion-tag" data-search="javascript">JavaScript ES6</button>
                      <button class="suggestion-tag" data-search="networking">Network Programming</button>
                      <button class="suggestion-tag" data-search="backend">Backend Development</button>
                      <button class="suggestion-tag" data-search="tutorial">Tutorial Guide</button>
                    </div>
                  </div>
                  <div class="suggestion-category">
                    <h4 class="category-title">T·ª´ kh√≥a hot</h4>
                    <div class="suggestion-tags">
                      <button class="suggestion-tag" data-search="microservices">Microservices</button>
                      <button class="suggestion-tag" data-search="docker">Docker</button>
                      <button class="suggestion-tag" data-search="kubernetes">Kubernetes</button>
                      <button class="suggestion-tag" data-search="api">API Design</button>
                      <button class="suggestion-tag" data-search="performance">Performance</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="filter-wrapper">
              <div class="filter-group">
                <select id="category-filter" class="category-filter">
                  <option value="">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
                  <option value="java">Java</option>
                  <option value="javascript">JavaScript</option>
                  <option value="networking">Networking</option>
                  <option value="backend">Backend</option>
                  <option value="tutorial">Tutorial</option>
                </select>
                
                <select id="tag-filter" class="tag-filter">
                  <option value="">T·∫•t c·∫£ tags</option>
                  <option value="java">Java</option>
                  <option value="jvm">JVM</option>
                  <option value="javac">Javac</option>
                  <option value="oop">OOP</option>
                  <option value="class">Class</option>
                  <option value="javascript">JavaScript</option>
                  <option value="es6">ES6</option>
                  <option value="modern-javascript">Modern JavaScript</option>
                  <option value="async">Async</option>
                  <option value="await">Await</option>
                  <option value="arrow-function">Arrow Function</option>
                  <option value="let-const">Let & Const</option>
                  <option value="comparison">Comparison</option>
                  <option value="frontend">Frontend</option>
                  <option value="backend">Backend</option>
                  <option value="web-development">Web Development</option>
                  <option value="so-sanh">So s√°nh</option>
                  <option value="newbie">Newbie</option>
                  <option value="programming">Programming</option>
                  <option value="ngon-ngu-lap-trinh">Ng√¥n ng·ªØ l·∫≠p tr√¨nh</option>
                  <option value="tutorial">Tutorial</option>
                </select>
                
                
                <select id="reading-time-filter" class="reading-time-filter">
                  <option value="">T·∫•t c·∫£ th·ªùi gian ƒë·ªçc</option>
                  <option value="short">Ng·∫Øn (< 5 ph√∫t)</option>
                  <option value="medium">Trung b√¨nh (5-10 ph√∫t)</option>
                  <option value="long">D√†i (> 10 ph√∫t)</option>
                </select>
                
                <select id="date-filter" class="date-filter">
                  <option value="">T·∫•t c·∫£ th·ªùi gian</option>
                  <option value="week">Tu·∫ßn n√†y</option>
                  <option value="month">Th√°ng n√†y</option>
                  <option value="quarter">3 th√°ng g·∫ßn</option>
                  <option value="year">NƒÉm nay</option>
                </select>
              </div>
              
              <div class="filter-actions">
                <button id="clear-filters" class="clear-filters-btn">X√≥a b·ªô l·ªçc</button>
                <button id="sort-toggle" class="sort-toggle-btn">
                  <span>S·∫Øp x·∫øp: M·ªõi nh·∫•t</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m6 9 6 6 6-6"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Blog Stats -->
          <div class="blog-stats">
            <div class="stat-item">
              <span class="stat-number">{{ len (where .Site.RegularPages "Section" "blog") }}</span>
              <span class="stat-label">B√†i vi·∫øt</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ len .Site.Taxonomies.categories }}</span>
              <span class="stat-label">Ch·ªß ƒë·ªÅ</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">1000+</span>
              <span class="stat-label">L∆∞·ª£t ƒë·ªçc</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Blog Content -->
    <section class="blog-content">
      <div class="content-container">
        
        <!-- Featured Posts -->
        <div class="featured-section">
          <h2 class="section-title">
            <span class="title-icon">‚≠ê</span>
            B√†i vi·∫øt n·ªïi b·∫≠t
          </h2>
          <div class="featured-posts">
            {{ range first 2 (where .Site.RegularPages "Section" "blog") }}
              <article class="featured-post">
                <a href="{{ .Permalink }}" class="featured-link">
                  <div class="featured-image">
                    {{ with .Params.featured_image }}
                    <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                    {{ else }}
                      <div class="featured-placeholder">
                        <svg viewBox="0 0 24 24" width="48" height="48" stroke="currentColor" stroke-width="1" fill="none">
                          <path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                      </div>
                    {{ end }}
                    <div class="featured-overlay">
                      <span class="featured-badge">N·ªïi b·∫≠t</span>
                    </div>
                  </div>
                  <div class="featured-content">
                    <h3 class="featured-title">{{ .Title }}</h3>
                    <p class="featured-excerpt">
                      {{ with .Summary }}
                        {{ . | plainify | truncate 150 }}
                      {{ else }}
                        {{ .Plain | truncate 150 }}
                      {{ end }}
                    </p>
                    <div class="featured-meta">
                      <time class="featured-date">{{ .Date.Format "02 Jan 2006" }}</time>
                      <span class="featured-reading-time">{{ .ReadingTime }} ph√∫t ƒë·ªçc</span>
                    </div>
                  </div>
                </a>
              </article>
            {{ end }}
          </div>
        </div>

        <!-- Popular Posts Section -->
        <div class="popular-section">
          <h2 class="section-title">
            <span class="title-icon">üî•</span>
            B√†i vi·∫øt ph·ªï bi·∫øn
          </h2>
          <div class="popular-posts">
            {{ range first 3 (where .Site.RegularPages "Section" "blog") }}
              <article class="popular-post" data-popularity="{{ add (mul .ReadingTime 2) (len .Params.tags) }}">
                <a href="{{ .Permalink }}" class="popular-link">
                  <div class="popular-rank">
                    <span class="rank-number">{{ add (sub 4 (len (slice .))) 1 }}</span>
                    <div class="rank-trend">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m3 16 4-4 4 4"></path>
                        <path d="M7 12h10"></path>
                      </svg>
                    </div>
                  </div>
                  <div class="popular-content">
                    <h3 class="popular-title">{{ .Title }}</h3>
                    <div class="popular-meta">
                      <span class="popular-views">{{ add (mul .ReadingTime 50) 200 }}+ l∆∞·ª£t ƒë·ªçc</span>
                      <span class="popular-date">{{ .Date.Format "02 Jan" }}</span>
                    </div>
                    <div class="popular-tags">
                      {{ range first 2 .Params.tags }}
                        <span class="popular-tag">{{ . }}</span>
                      {{ end }}
                    </div>
                  </div>
                </a>
              </article>
            {{ end }}
          </div>
        </div>

        <!-- All Posts -->
        <div class="all-posts-section">
          <h2 class="section-title">
            <span class="title-icon">üìù</span>
            T·∫•t c·∫£ b√†i vi·∫øt
          </h2>
          
          <div class="posts-grid" id="posts-container">
            {{ range (where .Site.RegularPages "Section" "blog") }}
              <article class="post-card" 
                       data-categories="{{ delimit .Params.categories " " }}"
                       data-tags="{{ delimit .Params.tags " " }}"
                       data-reading-time="{{ .ReadingTime }}"
                       data-date="{{ .Date.Format "2006-01-02" }}">
                <a href="{{ .Permalink }}" class="post-link">
                  <div class="post-image-wrapper">
                    {{ with .Params.featured_image }}
                    <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                    {{ else }}
                      <div class="post-placeholder">
                        <svg viewBox="0 0 24 24" width="32" height="32" stroke="currentColor" stroke-width="1.5" fill="none">
                          <path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                      </div>
                    {{ end }}
                    <div class="post-overlay"></div>
                  </div>
                  
                  <div class="post-content">
                    <div class="post-categories">
                      {{ range .Params.categories }}
                        <span class="category-tag">{{ . }}</span>
                      {{ end }}
                    </div>
                    
                    <h3 class="post-title">{{ .Title }}</h3>
                    
                    <p class="post-excerpt">
                      {{ with .Summary }}
                        {{ . | plainify | truncate 120 }}
                      {{ else }}
                        {{ .Plain | truncate 120 }}
                      {{ end }}
                    </p>
                    
                    <div class="post-meta">
                      <time class="post-date">{{ .Date.Format "02 Jan 2006" }}</time>
                      <span class="post-reading-time">{{ .ReadingTime }} ph√∫t</span>
                    </div>
                  </div>
                  
                  <div class="post-footer">
                    <div class="post-actions">
                      <span class="read-more">ƒê·ªçc ti·∫øp ‚Üí</span>
                      <div class="social-share-mini">
                        <button class="share-btn facebook" data-url="{{ .Permalink }}" data-title="{{ .Title }}">
                          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                          </svg>
                        </button>
                        <button class="share-btn twitter" data-url="{{ .Permalink }}" data-title="{{ .Title }}">
                          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                          </svg>
                        </button>
                        <button class="share-btn linkedin" data-url="{{ .Permalink }}" data-title="{{ .Title }}">
                          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </a>
              </article>
            {{ end }}
          </div>
          
          <!-- Pagination -->
          <div class="pagination-section">
            <div class="pagination-info">
              <span id="pagination-info">Hi·ªÉn th·ªã <span id="visible-count">0</span> / <span id="total-count">{{ len (where .Site.RegularPages "Section" "blog") }}</span> b√†i vi·∫øt</span>
            </div>
            <div class="pagination-controls">
              <button id="load-more" class="load-more-btn">
                <span>T·∫£i th√™m b√†i vi·∫øt</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m6 9 6 6 6-6"/>
                </svg>
              </button>
              <button id="show-all" class="show-all-btn" style="display: none;">
                Hi·ªÉn th·ªã t·∫•t c·∫£
              </button>
            </div>
          </div>
          
          <!-- No Results Message -->
          <div id="no-results" class="no-results" style="display: none;">
            <div class="no-results-icon">üîç</div>
            <h3 class="no-results-title">Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt</h3>
            <p class="no-results-text">Th·ª≠ thay ƒë·ªïi t·ª´ kh√≥a t√¨m ki·∫øm ho·∫∑c ch·ªçn ch·ªß ƒë·ªÅ kh√°c</p>
          </div>
        </div>

        <!-- Related Posts Section -->
        <div class="related-section">
          <h2 class="section-title">
            <span class="title-icon">üîó</span>
            B√†i vi·∫øt li√™n quan
          </h2>
          <div class="related-posts" id="related-posts">
            <!-- Related posts will be populated by JavaScript -->
          </div>
        </div>

        <!-- Reading Progress & Bookmarks -->
        <div class="reading-tools">
          <div class="reading-progress-bar">
            <div class="progress-label">Ti·∫øn ƒë·ªô ƒë·ªçc</div>
            <div class="progress-track">
              <div class="progress-fill" id="reading-progress-fill"></div>
            </div>
            <div class="progress-stats">
              <span id="posts-read">0</span> / <span id="total-posts">{{ len (where .Site.RegularPages "Section" "blog") }}</span> b√†i vi·∫øt
            </div>
          </div>
          
          <div class="bookmark-section">
            <button class="bookmark-toggle" id="bookmark-toggle">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
              </svg>
              <span>ƒê√°nh d·∫•u trang n√†y</span>
            </button>
            <div class="bookmark-list" id="bookmark-list">
              <div class="bookmark-header">
                <h4>ƒê√£ ƒë√°nh d·∫•u</h4>
                <button class="clear-bookmarks" id="clear-bookmarks">X√≥a t·∫•t c·∫£</button>
              </div>
              <div class="bookmark-items" id="bookmark-items">
                <!-- Bookmarks will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>

        <!-- Post Rating System -->
        <div class="rating-section">
          <h3 class="rating-title">ƒê√°nh gi√° b√†i vi·∫øt n√†y</h3>
          <div class="rating-stars" id="rating-stars">
            <button class="star" data-rating="1">‚òÖ</button>
            <button class="star" data-rating="2">‚òÖ</button>
            <button class="star" data-rating="3">‚òÖ</button>
            <button class="star" data-rating="4">‚òÖ</button>
            <button class="star" data-rating="5">‚òÖ</button>
          </div>
          <div class="rating-feedback">
            <textarea placeholder="Chia s·∫ª feedback c·ªßa b·∫°n..." id="rating-feedback"></textarea>
            <button class="submit-rating" id="submit-rating">G·ª≠i ƒë√°nh gi√°</button>
          </div>
        </div>

        <!-- Newsletter Signup -->
        <div class="newsletter-section">
          <div class="newsletter-content">
            <h2 class="newsletter-title">üì¨ ƒêƒÉng k√Ω nh·∫≠n b√†i vi·∫øt m·ªõi</h2>
            <p class="newsletter-description">
              Nh·∫≠n th√¥ng b√°o v·ªÅ nh·ªØng b√†i vi·∫øt m·ªõi nh·∫•t v·ªÅ l·∫≠p tr√¨nh m·∫°ng v√† c√¥ng ngh·ªá
            </p>
            <form class="newsletter-form" id="newsletter-form">
              <input type="email" placeholder="Email c·ªßa b·∫°n..." class="newsletter-input" required>
              <button type="submit" class="newsletter-button">ƒêƒÉng k√Ω</button>
            </form>
            <p class="newsletter-note">Ch√∫ng t√¥i t√¥n tr·ªçng quy·ªÅn ri√™ng t∆∞ c·ªßa b·∫°n. Kh√¥ng spam!</p>
          </div>
        </div>

      </div>
    </section>

  </div>

  <!-- Include CSS and JavaScript -->
  {{ $blogCSS := resources.Get "styles/blog.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $blogCSS.RelPermalink }}" integrity="{{ $blogCSS.Data.Integrity }}">
  
  <script>

    // Advanced Blog Search and Filter functionality
    (function() {
      const searchInput = document.getElementById('blog-search');
      const categoryFilter = document.getElementById('category-filter');
      const tagFilter = document.getElementById('tag-filter');
      const readingTimeFilter = document.getElementById('reading-time-filter');
      const dateFilter = document.getElementById('date-filter');
      const clearFiltersBtn = document.getElementById('clear-filters');
      const sortToggleBtn = document.getElementById('sort-toggle');
      const loadMoreBtn = document.getElementById('load-more');
      const showAllBtn = document.getElementById('show-all');
      const postsContainer = document.getElementById('posts-container');
      const noResults = document.getElementById('no-results');
      const visibleCountEl = document.getElementById('visible-count');
      const totalCountEl = document.getElementById('total-count');
      
      const allPosts = Array.from(document.querySelectorAll('.post-card'));
      let currentSort = 'newest';
      let postsPerPage = 6;
      let currentPage = 1;
      let filteredPosts = [...allPosts];

      // Initialize
      initializePagination();

      function initializePagination() {
        // Hide all posts initially
        allPosts.forEach((post, index) => {
          post.style.display = index < postsPerPage ? 'block' : 'none';
          post.dataset.originalIndex = index;
        });
        
        updatePaginationInfo();
        updateLoadMoreButton();
      }

      function filterPosts() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCategory = categoryFilter.value.toLowerCase();
        const selectedTag = tagFilter.value.toLowerCase();
        const selectedReadingTime = readingTimeFilter.value;
        const selectedDate = dateFilter.value;
        
        filteredPosts = allPosts.filter(post => {
          const title = post.querySelector('.post-title').textContent.toLowerCase();
          const excerpt = post.querySelector('.post-excerpt').textContent.toLowerCase();
          const categories = post.dataset.categories.toLowerCase();
          const tags = post.dataset.tags.toLowerCase();
          const readingTime = parseInt(post.dataset.readingTime);
          const postDate = new Date(post.dataset.date);
          
          // Search filter
          const matchesSearch = !searchTerm || 
            title.includes(searchTerm) || 
            excerpt.includes(searchTerm) ||
            categories.includes(searchTerm) ||
            tags.includes(searchTerm);
          
          // Category filter
          const matchesCategory = !selectedCategory || categories.includes(selectedCategory);
          
          // Tag filter
          const matchesTag = !selectedTag || tags.includes(selectedTag);
          
          // Reading time filter
          let matchesReadingTime = true;
          if (selectedReadingTime) {
            switch(selectedReadingTime) {
              case 'short':
                matchesReadingTime = readingTime < 5;
                break;
              case 'medium':
                matchesReadingTime = readingTime >= 5 && readingTime <= 10;
                break;
              case 'long':
                matchesReadingTime = readingTime > 10;
                break;
            }
          }
          
          // Date filter
          let matchesDate = true;
          if (selectedDate) {
            const now = new Date();
            switch(selectedDate) {
              case 'week':
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                matchesDate = postDate >= weekAgo;
                break;
              case 'month':
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                matchesDate = postDate >= monthAgo;
                break;
              case 'quarter':
                const quarterAgo = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                matchesDate = postDate >= quarterAgo;
                break;
              case 'year':
                const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                matchesDate = postDate >= yearAgo;
                break;
            }
          }
          
          return matchesSearch && matchesCategory && matchesTag && matchesReadingTime && matchesDate;
        });

        // Sort filtered posts
        sortPosts();
        
        // Reset pagination
        currentPage = 1;
        displayFilteredPosts();
        updatePaginationInfo();
        updateLoadMoreButton();
      }

      function sortPosts() {
        filteredPosts.sort((a, b) => {
          switch(currentSort) {
            case 'newest':
              return new Date(b.dataset.date) - new Date(a.dataset.date);
            case 'oldest':
              return new Date(a.dataset.date) - new Date(b.dataset.date);
            case 'shortest':
              return parseInt(a.dataset.readingTime) - parseInt(b.dataset.readingTime);
            case 'longest':
              return parseInt(b.dataset.readingTime) - parseInt(a.dataset.readingTime);
            default:
              return 0;
          }
        });
      }

      function displayFilteredPosts() {
        // Hide all posts first
        allPosts.forEach(post => {
          post.style.display = 'none';
          post.classList.remove('animate-in');
        });

        // Show filtered posts up to current page
        const postsToShow = filteredPosts.slice(0, currentPage * postsPerPage);
        postsToShow.forEach((post, index) => {
          post.style.display = 'block';
          post.classList.add('animate-in');
          // Add delay for animation
          setTimeout(() => {
            post.style.opacity = '1';
            post.style.transform = 'translateY(0)';
          }, index * 100);
        });

        // Show/hide no results message
        if (filteredPosts.length === 0) {
          noResults.style.display = 'block';
        } else {
          noResults.style.display = 'none';
        }
      }

      function updatePaginationInfo() {
        const visibleCount = Math.min(filteredPosts.length, currentPage * postsPerPage);
        visibleCountEl.textContent = visibleCount;
        totalCountEl.textContent = filteredPosts.length;
      }

      function updateLoadMoreButton() {
        const hasMorePosts = filteredPosts.length > currentPage * postsPerPage;
        loadMoreBtn.style.display = hasMorePosts ? 'flex' : 'none';
        showAllBtn.style.display = hasMorePosts ? 'flex' : 'none';
      }

      function loadMorePosts() {
        currentPage++;
        displayFilteredPosts();
        updatePaginationInfo();
        updateLoadMoreButton();
      }

      function showAllPosts() {
        currentPage = Math.ceil(filteredPosts.length / postsPerPage);
        displayFilteredPosts();
        updatePaginationInfo();
        updateLoadMoreButton();
      }

      function clearAllFilters() {
        searchInput.value = '';
        categoryFilter.value = '';
        tagFilter.value = '';
        readingTimeFilter.value = '';
        dateFilter.value = '';
        filterPosts();
      }

      function toggleSort() {
        const sortOptions = ['newest', 'oldest', 'shortest', 'longest'];
        const currentIndex = sortOptions.indexOf(currentSort);
        const nextIndex = (currentIndex + 1) % sortOptions.length;
        currentSort = sortOptions[nextIndex];
        
        const sortLabels = {
          'newest': 'M·ªõi nh·∫•t',
          'oldest': 'C≈© nh·∫•t', 
          'shortest': 'Ng·∫Øn nh·∫•t',
          'longest': 'D√†i nh·∫•t'
        };
        
        sortToggleBtn.querySelector('span').textContent = `S·∫Øp x·∫øp: ${sortLabels[currentSort]}`;
        filterPosts();
      }

      // Event listeners
      searchInput.addEventListener('input', filterPosts);
      categoryFilter.addEventListener('change', filterPosts);
      tagFilter.addEventListener('change', filterPosts);
      readingTimeFilter.addEventListener('change', filterPosts);
      dateFilter.addEventListener('change', filterPosts);
      clearFiltersBtn.addEventListener('click', clearAllFilters);
      sortToggleBtn.addEventListener('click', toggleSort);
      loadMoreBtn.addEventListener('click', loadMorePosts);
      showAllBtn.addEventListener('click', showAllPosts);

      // Newsletter form
      const newsletterForm = document.getElementById('newsletter-form');
      newsletterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = this.querySelector('.newsletter-input').value;
        
        // Simple validation
        if (email && email.includes('@')) {
          alert('C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω! Ch√∫ng t√¥i s·∫Ω g·ª≠i th√¥ng b√°o v·ªÅ nh·ªØng b√†i vi·∫øt m·ªõi.');
          this.reset();
        } else {
          alert('Vui l√≤ng nh·∫≠p email h·ª£p l·ªá.');
        }
      });

      // Social Sharing functionality
      document.addEventListener('click', function(e) {
        if (e.target.closest('.share-btn')) {
          e.preventDefault();
          e.stopPropagation();
          
          const shareBtn = e.target.closest('.share-btn');
          const platform = shareBtn.classList.contains('facebook') ? 'facebook' :
                          shareBtn.classList.contains('twitter') ? 'twitter' :
                          shareBtn.classList.contains('linkedin') ? 'linkedin' : null;
          
          const url = shareBtn.dataset.url;
          const title = shareBtn.dataset.title;
          
          if (platform && url && title) {
            shareToSocial(platform, url, title);
          }
        }
      });

      function shareToSocial(platform, url, title) {
        const encodedUrl = encodeURIComponent(url);
        const encodedTitle = encodeURIComponent(title);
        const encodedText = encodeURIComponent(`${title} - Blog L·∫≠p Tr√¨nh M·∫°ng`);
        
        let shareUrl = '';
        
        switch(platform) {
          case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
            break;
          case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedText}`;
            break;
          case 'linkedin':
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
            break;
        }
        
        if (shareUrl) {
          window.open(shareUrl, '_blank', 'width=600,height=400,scrollbars=yes,resizable=yes');
          
          // Track sharing event
          if (typeof gtag !== 'undefined') {
            gtag('event', 'share', {
              method: platform,
              content_type: 'blog_post',
              item_id: url
            });
          }
        }
      }

      // Animations on scroll
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
          }
        });
      }, observerOptions);

      // Observe all post cards
      allPosts.forEach(post => {
        observer.observe(post);
      });
    })();

    // Advanced Features: Related Posts, Popular Posts, Search Suggestions, Reading Progress, Bookmarks, Rating
    (function() {
      // Related Posts functionality
      function generateRelatedPosts() {
        const allPosts = Array.from(document.querySelectorAll('.post-card'));
        const relatedContainer = document.getElementById('related-posts');
        
        if (!relatedContainer || allPosts.length === 0) return;
        
        // Simple algorithm: find posts with similar categories/tags
        const currentPost = allPosts[0]; // Assuming we're on a specific post page
        const currentCategories = currentPost.dataset.categories?.split(' ') || [];
        const currentTags = currentPost.dataset.tags?.split(' ') || [];
        
        const relatedPosts = allPosts.slice(1, 4).map(post => {
          const postCategories = post.dataset.categories?.split(' ') || [];
          const postTags = post.dataset.tags?.split(' ') || [];
          
          // Calculate similarity score
          const categoryMatch = currentCategories.filter(cat => postCategories.includes(cat)).length;
          const tagMatch = currentTags.filter(tag => postTags.includes(tag)).length;
          const similarityScore = categoryMatch * 2 + tagMatch;
          
          return { post, score: similarityScore };
        }).sort((a, b) => b.score - a.score).slice(0, 3);
        
        // Render related posts
        relatedContainer.innerHTML = relatedPosts.map(({ post }) => {
          const title = post.querySelector('h3')?.textContent || '';
          const excerpt = post.querySelector('.post-excerpt')?.textContent || '';
          const link = post.querySelector('a')?.href || '';
          const date = post.querySelector('.post-date')?.textContent || '';
          
          return `
            <article class="related-post">
              <a href="${link}" class="related-link">
                <div class="related-content">
                  <h4 class="related-title">${title}</h4>
                  <p class="related-excerpt">${excerpt}</p>
                  <div class="related-meta">
                    <time class="related-date">${date}</time>
                    <span class="related-reading-time">${post.dataset.readingTime} ph√∫t</span>
                  </div>
                </div>
              </a>
            </article>
          `;
        }).join('');
      }
      
      // Search Suggestions functionality
      function initializeSearchSuggestions() {
        const searchInput = document.getElementById('blog-search');
        const suggestionsContainer = document.getElementById('search-suggestions');
        const suggestionsClose = document.getElementById('suggestions-close');
        const suggestionTags = document.querySelectorAll('.suggestion-tag');
        
        if (!searchInput || !suggestionsContainer) return;
        
        // Show suggestions on focus
        searchInput.addEventListener('focus', () => {
          suggestionsContainer.style.display = 'block';
        });
        
        // Hide suggestions on click outside
        document.addEventListener('click', (e) => {
          if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
            suggestionsContainer.style.display = 'none';
          }
        });
        
        // Close suggestions
        suggestionsClose.addEventListener('click', () => {
          suggestionsContainer.style.display = 'none';
        });
        
        // Handle suggestion tag clicks
        suggestionTags.forEach(tag => {
          tag.addEventListener('click', () => {
            const searchTerm = tag.dataset.search;
            searchInput.value = searchTerm;
            searchInput.dispatchEvent(new Event('input'));
            suggestionsContainer.style.display = 'none';
          });
        });
      }
      
      // Reading Progress functionality
      function initializeReadingProgress() {
        const progressFill = document.getElementById('reading-progress-fill');
        const postsReadEl = document.getElementById('posts-read');
        const totalPostsEl = document.getElementById('total-posts');
        
        if (!progressFill || !postsReadEl) return;
        
        // Load reading progress from localStorage
        const readPosts = JSON.parse(localStorage.getItem('readPosts') || '[]');
        const totalPosts = parseInt(totalPostsEl.textContent) || 0;
        
        postsReadEl.textContent = readPosts.length;
        progressFill.style.width = `${(readPosts.length / totalPosts) * 100}%`;
        
        // Track post views
        const postCards = document.querySelectorAll('.post-card');
        postCards.forEach(card => {
          const link = card.querySelector('a');
          if (link) {
            link.addEventListener('click', () => {
              const postUrl = link.href;
              if (!readPosts.includes(postUrl)) {
                readPosts.push(postUrl);
                localStorage.setItem('readPosts', JSON.stringify(readPosts));
                postsReadEl.textContent = readPosts.length;
                progressFill.style.width = `${(readPosts.length / totalPosts) * 100}%`;
              }
            });
          }
        });
      }
      
      // Bookmarks functionality
      function initializeBookmarks() {
        const bookmarkToggle = document.getElementById('bookmark-toggle');
        const bookmarkList = document.getElementById('bookmark-list');
        const bookmarkItems = document.getElementById('bookmark-items');
        const clearBookmarks = document.getElementById('clear-bookmarks');
        
        if (!bookmarkToggle || !bookmarkList) return;
        
        // Load bookmarks from localStorage
        const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
        
        function updateBookmarkDisplay() {
          if (bookmarks.length === 0) {
            bookmarkItems.innerHTML = '<p class="no-bookmarks">Ch∆∞a c√≥ bookmark n√†o</p>';
            return;
          }
          
          bookmarkItems.innerHTML = bookmarks.map((bookmark, index) => `
            <div class="bookmark-item">
              <a href="${bookmark.url}" class="bookmark-link">${bookmark.title}</a>
              <button class="remove-bookmark" data-index="${index}">√ó</button>
            </div>
          `).join('');
          
          // Add remove bookmark listeners
          document.querySelectorAll('.remove-bookmark').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const index = parseInt(e.target.dataset.index);
              bookmarks.splice(index, 1);
              localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
              updateBookmarkDisplay();
            });
          });
        }
        
        // Toggle bookmark for current page
        bookmarkToggle.addEventListener('click', () => {
          const currentUrl = window.location.href;
          const currentTitle = document.title;
          
          const existingIndex = bookmarks.findIndex(b => b.url === currentUrl);
          
          if (existingIndex !== -1) {
            bookmarks.splice(existingIndex, 1);
            bookmarkToggle.classList.remove('bookmarked');
            bookmarkToggle.querySelector('span').textContent = 'ƒê√°nh d·∫•u trang n√†y';
          } else {
            bookmarks.push({ url: currentUrl, title: currentTitle, date: new Date().toISOString() });
            bookmarkToggle.classList.add('bookmarked');
            bookmarkToggle.querySelector('span').textContent = 'ƒê√£ ƒë√°nh d·∫•u';
          }
          
          localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
          updateBookmarkDisplay();
        });
        
        // Clear all bookmarks
        clearBookmarks.addEventListener('click', () => {
          if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ bookmark?')) {
            localStorage.removeItem('bookmarks');
            bookmarks.length = 0;
            updateBookmarkDisplay();
          }
        });
        
        // Check if current page is bookmarked
        const currentUrl = window.location.href;
        const isBookmarked = bookmarks.some(b => b.url === currentUrl);
        if (isBookmarked) {
          bookmarkToggle.classList.add('bookmarked');
          bookmarkToggle.querySelector('span').textContent = 'ƒê√£ ƒë√°nh d·∫•u';
        }
        
        updateBookmarkDisplay();
      }
      
      // Rating system functionality
      function initializeRating() {
        const stars = document.querySelectorAll('.star');
        const submitRating = document.getElementById('submit-rating');
        const ratingFeedback = document.getElementById('rating-feedback');
        
        if (!stars.length || !submitRating) return;
        
        let currentRating = 0;
        
        stars.forEach((star, index) => {
          star.addEventListener('click', () => {
            currentRating = index + 1;
            updateStars(currentRating);
          });
          
          star.addEventListener('mouseenter', () => {
            updateStars(index + 1);
          });
        });
        
        document.getElementById('rating-stars').addEventListener('mouseleave', () => {
          updateStars(currentRating);
        });
        
        function updateStars(rating) {
          stars.forEach((star, index) => {
            if (index < rating) {
              star.classList.add('active');
            } else {
              star.classList.remove('active');
            }
          });
        }
        
        submitRating.addEventListener('click', () => {
          if (currentRating === 0) {
            alert('Vui l√≤ng ch·ªçn s·ªë sao ƒë√°nh gi√°');
            return;
          }
          
          const feedback = ratingFeedback.value.trim();
          const ratingData = {
            rating: currentRating,
            feedback: feedback,
            url: window.location.href,
            date: new Date().toISOString()
          };
          
          // Store rating in localStorage
          const ratings = JSON.parse(localStorage.getItem('ratings') || '[]');
          ratings.push(ratingData);
          localStorage.setItem('ratings', JSON.stringify(ratings));
          
          alert(`C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√° ${currentRating} sao!`);
          ratingFeedback.value = '';
          currentRating = 0;
          updateStars(0);
        });
      }
      
      // Initialize all advanced features
      function initializeAdvancedFeatures() {
        generateRelatedPosts();
        initializeSearchSuggestions();
        initializeReadingProgress();
        initializeBookmarks();
        initializeRating();
      }
      
      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeAdvancedFeatures);
      } else {
        initializeAdvancedFeatures();
      }
      
    })();
  </script>
{{ end }}
